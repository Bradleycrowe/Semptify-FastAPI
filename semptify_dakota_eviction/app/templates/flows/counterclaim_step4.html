{% extends "layouts/base.html" %}

{% block title %}{{ strings.nav_counterclaim }} - Download{% endblock %}

{% block content %}
<div class="steps">
    {% for i in range(1, total_steps + 1) %}
    <div class="step {% if i < step %}completed{% elif i == step %}active{% endif %}">
        {% if i < step %}âœ“{% else %}{{ i }}{% endif %}
    </div>
    {% if i < total_steps %}
    <div class="step-line {% if i < step %}completed{% endif %}"></div>
    {% endif %}
    {% endfor %}
</div>

<div class="card text-center">
    <div style="font-size: 4rem; margin-bottom: 1rem;">âš–ï¸</div>
    <h1 class="card-title" style="font-size: 1.75rem;">
        {% if lang == 'en' %}Your Counterclaim is Ready!{% elif lang == 'es' %}Â¡Su Contrademanda EstÃ¡ Lista!{% elif lang == 'so' %}Dacwadaada Lid ah Waa Diyaar!{% else %}Ø¯Ø¹ÙˆØ§Ùƒ Ø§Ù„Ù…Ø¶Ø§Ø¯Ø© Ø¬Ø§Ù‡Ø²Ø©!{% endif %}
    </h1>
    <p class="card-description">
        {% if lang == 'en' %}Download and file with your Answer.{% elif lang == 'es' %}Descargue y presente con su Respuesta.{% elif lang == 'so' %}Soo deji oo xaree Jawaabta.{% else %}Ø­Ù…Ù‘Ù„ ÙˆÙ‚Ø¯Ù… Ù…Ø¹ Ø±Ø¯Ùƒ.{% endif %}
    </p>
    <div class="mt-4">
        <button onclick="downloadCounterclaim()" class="btn btn-primary" style="font-size: 1.1rem; padding: 1rem 2rem;">
            ğŸ“¥ {{ strings.btn_download }}
        </button>
    </div>
</div>

<div class="alert alert-warning mt-4">
    <div class="alert-icon">ğŸ“‹</div>
    <div>
        {% if lang == 'en' %}
        <strong>File your Counterclaim with your Answer</strong> - Both must be filed within 7 days of service.
        {% elif lang == 'es' %}
        <strong>Presente su Contrademanda con su Respuesta</strong> - Ambos deben presentarse dentro de 7 dÃ­as.
        {% elif lang == 'so' %}
        <strong>Xaree Dacwadaada Lid ah Jawaabta</strong> - Labadaba waa in la xareeyaa 7 maalmood gudahood.
        {% else %}
        <strong>Ù‚Ø¯Ù… Ø¯Ø¹ÙˆØ§Ùƒ Ø§Ù„Ù…Ø¶Ø§Ø¯Ø© Ù…Ø¹ Ø±Ø¯Ùƒ</strong> - ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… ÙƒÙ„ÙŠÙ‡Ù…Ø§ Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù….
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function downloadCounterclaim() {
    const formData = {
        tenant_name: localStorage.getItem('tenant_name') || 'Tenant Name',
        landlord_name: localStorage.getItem('landlord_name') || 'Landlord Name',
        case_number: localStorage.getItem('case_number') || '',
        address: localStorage.getItem('address') || '',
        claims: JSON.parse(localStorage.getItem('claims') || '[]'),
        claim_details: localStorage.getItem('claim_details') || '',
        damages_requested: localStorage.getItem('damages_requested') || ''
    };
    
    try {
        const response = await fetch('/flows/counterclaim/generate?lang={{ lang }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Counterclaim.pdf';
            document.body.appendChild(a);
            a.click();
            a.remove();
        }
    } catch (error) {
        console.error('Download error:', error);
    }
}
</script>
{% endblock %}
